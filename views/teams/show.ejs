
<div class="team-section-show">

  
  <div class="breadcrumbs">
    <nav>
    <div class="container">
        <ol class="breadcrumb-card">
        <li><a href="/">Inicio</a> / <a href="/teams">Equipos</a> / <%= team.title %></li>
        </ol>
    </div>
    </nav>
  </div>
  
  
  <div class="section-header">
    <h2><%= team.title %></h2>
    
  </div>

  <div class="unirseequipo">
    <% if (locals.loginUser && !locals.isMember) { %> 
      <form method="post" action="/teams/<%= team.id %>/join">
        <button type="submit" class="btn join-btn">Unirme al Equipo</button>
      </form>
    <% } %>

    <% if (locals.loginUser && locals.isMember) { %> 
      <form method="post" action="/teams/<%= team.id %>/leave">
        <button type="submit" class="btn">Abandonar Equipo</button>
      </form>
    <% } %>
  </div>

  <div class="card">
    <div class="team-info">
      <div class="team-image">
        <%- include('../attachments/_attachmentTeams', { team: team }) %>
      </div>
      <div class="team-body">
        <h1 class="team-title"><%= team.title %></h1>
        <p class="team-description"><%= team.body %></p>
      </div>
      <div class="team-badge">
        <img src="/images/3D-icons/medalla-icono-4.PNG">
      </div>
    </div>
  </div>

  <div class="card">
    <div class="team-stats">
      <div class="row">
        <div class="col-md-4">
          <div class="stat-item">
            <img class="stat-icon" src="/images/3D-icons/grupousers-icon-1.PNG">
            <div class="stat-info">
              <div class="stat-title">Número de usuarios</div>
              <div class="stat-value"><%= team.numUsers %></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <img class="stat-icon" src="/images/3D-icons/autor-icon-2.PNG">
            <div class="stat-info">
              <div class="stat-title">Autor</div>
              <div class="stat-value"><%= team.author?.username ?? "Anonymous" %></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <img class="stat-icon" src="/images/3D-icons/admin-icon-3.PNG">
            <div class="stat-info">
              <div class="stat-title">Admin del equipo</div>
              <div class="stat-value"><%= adminUser?.username ?? 'None' %></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <img class="stat-icon" src="/images/3D-icons/calendar-icon-3.PNG">
            <div class="stat-info">
              <div class="stat-title">Fecha creación</div>
              <div class="stat-value"><%= team.createdAt %></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <img class="stat-icon" src="/images/3D-icons/coins-icon-11.PNG">
            <div class="stat-info">
              <div class="stat-title">Número de tokens</div>
              <div class="stat-value"><%= totalTokens %></div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="stat-item">
            <img class="stat-icon" src="/images/3D-icons/lista-ico-5.PNG">
            <div class="stat-info">
              <div class="stat-title">Fecha última actualización</div>
              <div class="stat-value"><%= team.updatedAt %></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

    
  </div>
 

  <div class="section-header">
    <div class="section-header-equipoicono">
      <h2>Miembros del equipo <img class="header-icon" src="/images/3D-icons/team-icon-1.PNG"></h2>
    </div>
  </div>

    <div class="card">
      <div class="tablausuarios">
      <table>
        <thead>
            <tr>
              <th><div class="scale-on-hover">Nombre de usuario <img class="header-icon" src="/images/3D-icons/star-icon-1.PNG"></div></th>
              <th><div class="scale-on-hover">Wallet <img class="header-icon" src="/images/3D-icons/cartera-icon-1.PNG"></div></th>
              <th><div class="scale-on-hover">Tokens <img class="header-icon" src="/images/3D-icons/coins-icon-15.PNG"></div></th>
              <th><div class="scale-on-hover">Reputación <img class="header-icon" src="/images/3D-icons/corona-icon-3.PNG"></div></th>
            </tr>
        </thead>
        <tbody>
            <% teamMembers.forEach(member => { %>
              <tr>
                <td><div class="scale-on-hover"><%= member.user.username %></div></td>
                <td><div class="scale-on-hover"><%= member.wallet %></div></td>
                <td><div class="scale-on-hover"><%= member.tokens %></div></td>
                <td>
                  <div class="progress-bar-container scale-on-hover" data-reputation="<%= member.reputation %>">
                      <div class="progress-bar"></div>
                      <span class="percentage"><%= member.reputation %> %</span>
                  </div>
                </td>
            </tr>
            <% }) %>
        </tbody>
      </table> 
      </div>
    </div>
    
    <% if (locals.loginUser && locals.isMember) { %> 
    <div class="section-header">
      <h2>Acciones del equipo</h2>
    </div>
    <% } %>
    <div class="tarjetasaccion">
    <% if (locals.loginUser && locals.isMember) { %> 
      <div class="card donation-form">
          <h3 class="donarpuntos">Donar puntos de la Wallet</h3>
          <form method="post" action="/teams/<%= team.id %>/donate">
                  <div class="form-group">
                          <label for="recipient">Destinatario:</label>
                          <div class="user-buttons">
                                  <% teamMembers.forEach(member => { %>
                                          <% if (member.user.id !== locals.loginUser.id) { %>
                                                  <button type="button" class="user-button" onclick="selectRecipient(this)" data-id="<%= member.user.id %>">
                                                          <%= member.user.username %>
                                                  </button>
                                          <% } %>
                                  <% }) %>
                          </div>
                          <input type="hidden" name="recipient" id="recipient">
                  </div>
  
                  <div class="form-group">
                          <label for="amount">Cantidad: <span id="amountLabel">1</span></label>
                          <input type="range" name="amount" id="amount" min="1" max="<%= locals.loginUser.wallet %>" value="1" oninput="updateAmountLabel(this.value)" required>
                  </div>
                  
                    <button type="submit" class="btn donate-button">Donar</button>
                  
          </form>
      </div>
    <% } %>

    <% if (locals.loginUser && locals.isMember && !locals.loginUser.isAdmin) { %> 
      <div class="card inflate-form">
        
        <img src="/images/3D-icons/billetes-icon-2.PNG" alt="Descripción de la imagen">

      </div>
    <% } %>

    <% if (locals.loginUser && locals.loginUser.isAdmin) { %> 
      <div class="card inflate-form">
        <h3 class="inflaciontext">Inflación</h3>
        <p>Al presionar este botón, los tokens de todos los miembros del equipo se reducirán en un 50%.</p>
        <form method="post" action="/teams/<%= team.id %>/inflate">
          <button type="submit" class="inflate-button">Aplicar</button>
        </form>
      </div>
    <% } %>
    </div>

    <div class="button-container-volverateams">
      <a href="/teams" class="volverateams">Volver</a>
    </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      var progressBarContainers = document.querySelectorAll('.progress-bar-container');
      progressBarContainers.forEach(function(container) {
          var reputation = container.getAttribute('data-reputation');
          var progressBar = container.querySelector('.progress-bar');
          progressBar.style.width = reputation + '%';
      });
  });
</script>

<script>
  function updateAmountLabel(value) {
    document.getElementById('amountLabel').textContent = value;
  }
</script>

<script>
  function selectRecipient(button) {
    document.querySelectorAll('.user-button').forEach(button => button.classList.remove('selected'));
    button.classList.add('selected');
    document.getElementById('recipient').value = button.dataset.id;
  }

  function updateAmountLabel(value) {
    document.getElementById('amountLabel').textContent = value;
  }
</script>